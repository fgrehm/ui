<% head "live_search_js" do %>
<script type="text/javascript" charset="utf-8">
  var live_search_timeout;
  var live_search_last_keypress;
  var live_search_interval = 750;

  $(function() {
    $(".live_search input").keyup(function(e) {
      if ( e.keyCode == 224 || e.keyCode == 91 || e.keyCode == 9 || (e.keyCode >=37 && e.keyCode <= 40) ) return;

      if ( $(this).val().length == 1 ) return;

      if ( e.keyCode == 13 ) {
        window.clearTimeout(live_search_timeout);
      }
      else {
        window.clearTimeout(live_search_timeout);

        if(live_search_last_keypress) {
          live_search_interval = (new Date() - live_search_last_keypress) > 500 ? 1000 : 400;
        }

        live_search_last_keypress = new Date();
        live_search_timeout = window.setTimeout(function() {
          $(".live_search").trigger("submit");
        }, live_search_interval);
      }
    });

    $(".live_search select").change(function() {
      $(".live_search").trigger("submit");
    });

    $(".live_search").submit(function() {
      var query = $(this).serialize();
      $(".preserve_location").each(function() {
        this.href = mergeParams(this.href, query);
      });

      $("#<%= @list_id %>").load(window.location + "?" + query, null, <%= @callback || "null" %>);
      return false;
    });
  });
</script>
<% end %>